version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 18  # í˜¹ì€ ì‚¬ìš© ì¤‘ì¸ ë²„ì „ (16, 18, 20 ë“±)
    commands:
      - echo Installing dependencies...
      - npm install
  build:
    commands:
      - echo Build started on `date`
      - npm run build
  post_build:
    commands:
      - echo Build completed on `date`
      - echo Deploying to S3...
      # 1. S3ì— ì—…ë¡œë“œ (ê¸°ì¡´ íŒŒì¼ ì‚­ì œí•˜ê³  ë®ì–´ì“°ê¸°)
      # ğŸš¨ ì•„ë˜ 'your-s3-bucket-name'ì„ ë³¸ì¸ ë²„í‚· ì´ë¦„ìœ¼ë¡œ ìˆ˜ì •í•˜ì„¸ìš”!
      - aws s3 sync build/ s3://a1174-prod-frontend --delete
      
      - echo Invalidating CloudFront cache...
      # 2. CloudFront ìºì‹œ ì‚­ì œ (ì‚¬ìš©ìê°€ ì¦‰ì‹œ ìƒˆ ë²„ì „ì„ ë³´ë„ë¡)
      # ğŸš¨ ì•„ë˜ 'your-distribution-id'ë¥¼ ë³¸ì¸ CloudFront IDë¡œ ìˆ˜ì •í•˜ì„¸ìš”!
      - aws cloudfront create-invalidation --distribution-id E33WGEISDPLXIY --paths "/*"